# 🔍 论文搜索功能使用指南

## 🎯 功能概述

论文搜索功能已完全实现！你现在可以：
- ✅ 按标题、作者、期刊搜索论文
- ✅ 按年份筛选论文
- ✅ 按类型筛选论文（期刊/会议/书籍/章节）
- ✅ 搜索结果高亮显示关键词
- ✅ 分页浏览搜索结果
- ✅ 从首页快速访问搜索功能

---

## 🚀 使用步骤（手把手教程）

### 第1步：启动应用
```bash
mvn spring-boot:run
```

### 第2步：访问首页
```
http://localhost:8080/
```

### 第3步：使用搜索功能

#### 方式1：从首页搜索（推荐）

1. **在首页找到"搜索论文"框**
   - 在页面顶部，教授列表上方
   - 有一个白色的搜索框区域

2. **输入关键词**
   - 可以搜索论文标题
   - 可以搜索作者姓名
   - 可以搜索期刊名称

3. **点击"搜索"按钮**
   - 会跳转到搜索结果页面

#### 方式2：直接访问搜索页面

访问：
```
http://localhost:8080/publications/search
```

---

## 📝 搜索功能详解

### 1. 关键词搜索

**支持搜索的字段**：
- 论文标题（title）
- 作者列表（authors）
- 期刊/会议名称（journal）

**搜索特性**：
- 不区分大小写
- 支持部分匹配（如搜索"data"可以找到"Database"）
- 关键词在结果中会以黄色高亮显示

**示例搜索**：
- 搜索"machine learning" → 找到标题或作者中包含此关键词的论文
- 搜索"Zhang" → 找到作者姓名中包含Zhang的论文
- 搜索"IEEE" → 找到在IEEE期刊发表的论文

### 2. 年份筛选

在搜索结果页面，可以：

1. **点击"所有年份"下拉框**
2. **选择特定年份**
   - 下拉框会自动显示数据库中所有的年份
   - 按降序排列（最新的在前）
3. **自动刷新结果**
   - 选择后会立即筛选该年份的论文

**组合使用**：
- 搜索"deep learning" + 筛选"2024年" → 找到2024年发表的深度学习相关论文

### 3. 类型筛选

在搜索结果页面，可以：

1. **点击"所有类型"下拉框**
2. **选择论文类型**：
   - 期刊论文（JOURNAL）
   - 会议论文（CONFERENCE）
   - 书籍（BOOK）
   - 书籍章节（BOOK_CHAPTER）
3. **自动刷新结果**

**不同类型的标识**：
- 期刊论文：蓝色标签
- 会议论文：紫色标签
- 书籍：橙色标签
- 书籍章节：绿色标签

### 4. 清除筛选

点击"清除筛选"按钮，可以：
- 清除所有搜索关键词
- 清除年份筛选
- 清除类型筛选
- 回到初始搜索状态

### 5. 分页浏览

当搜索结果超过20条时：

1. **查看页码信息**
   - 在搜索结果上方显示：第 X / Y 页
   - 下方显示找到的总数量

2. **切换页面**
   - 点击页码数字直接跳转
   - 点击 "< " 上一页
   - 点击 " >" 下一页
   - 当前页会高亮显示（蓝色背景）

3. **每页显示数量**
   - 默认每页显示20条论文
   - 可以通过URL参数修改：`?size=50`

---

## 🖼️ 界面说明

### 首页搜索框
```
┌─────────────────────────────────────────────┐
│          🔍 搜索论文                         │
├─────────────────────────────────────────────┤
│  [搜索论文标题、作者、期刊...]   [🔍 搜索]  │
└─────────────────────────────────────────────┘
```

### 搜索结果页面
```
┌─────────────────────────────────────────────┐
│  [搜索框________________________] [🔍 搜索]  │
│                                             │
│  筛选：[所有年份 ▼] [所有类型 ▼] [❌清除]   │
├─────────────────────────────────────────────┤
│  ✅ 找到 42 篇论文 包含关键词 "machine"      │
│  第 1 / 3 页                                │
├─────────────────────────────────────────────┤
│  ┌───────────────────────────────────────┐ │
│  │ Machine Learning in Healthcare        │ │
│  │ 👥 Zhang Wei, Li Ming                │ │
│  │ 📖 IEEE Transactions                  │ │
│  │ 📅 2024  [期刊论文]  📄 PDF          │ │
│  └───────────────────────────────────────┘ │
│                                             │
│  ┌───────────────────────────────────────┐ │
│  │ Deep Learning Applications            │ │
│  │ 👥 Wang Fang                         │ │
│  │ 📖 ACM Conference                     │ │
│  │ 📅 2023  [会议论文]                   │ │
│  └───────────────────────────────────────┘ │
│                                             │
│  [< 1 2 3 >]                               │
└─────────────────────────────────────────────┘
```

---

## 🎨 高亮显示说明

搜索结果中，关键词会以黄色背景高亮显示：

**示例**：
搜索"machine learning"

显示效果：
- 标题："<mark style="background: yellow;">Machine Learning</mark> in Healthcare"
- 作者："Zhang Wei (专注于<mark style="background: yellow;">Machine Learning</mark>)"
- 期刊："IEEE Transactions on <mark style="background: yellow;">Machine Learning</mark>"

---

## 📊 搜索技巧

### 1. 精确搜索
- 搜索完整的词语会更精确
- 例如：搜索"neural network"而不是"neural"

### 2. 作者搜索
- 搜索作者姓氏
- 例如：搜索"Zhang"可以找到所有张姓作者的论文

### 3. 期刊搜索
- 搜索期刊或会议的缩写
- 例如：搜索"IEEE"、"ACM"、"CVPR"

### 4. 组合筛选
- 先输入关键词搜索
- 再使用年份和类型筛选缩小范围
- 例如：搜索"AI" + 2024年 + 期刊论文

### 5. 无结果时的建议
- 尝试更简短的关键词
- 检查拼写是否正确
- 减少筛选条件
- 尝试搜索相关词汇

---

## 🔧 技术细节

### 后端实现

#### 搜索查询（JPQL）
```java
@Query("SELECT p FROM Publication p WHERE " +
        "(:keyword IS NULL OR :keyword = '' OR " +
        "LOWER(p.title) LIKE LOWER(CONCAT('%', :keyword, '%')) OR " +
        "LOWER(p.authors) LIKE LOWER(CONCAT('%', :keyword, '%')) OR " +
        "LOWER(p.journal) LIKE LOWER(CONCAT('%', :keyword, '%'))) AND " +
        "(:year IS NULL OR p.year = :year) AND " +
        "(:type IS NULL OR p.publicationType = :type) " +
        "ORDER BY p.year DESC, p.id DESC")
Page<Publication> searchPublications(
        @Param("keyword") String keyword,
        @Param("year") Integer year,
        @Param("type") PublicationType type,
        Pageable pageable
);
```

**查询特性**：
- 使用LIKE实现模糊搜索
- LOWER()函数实现不区分大小写
- 支持多字段搜索（OR连接）
- 支持可选参数（IS NULL判断）
- 按年份降序排序

#### 分页参数
- **page**: 页码（从0开始）
- **size**: 每页数量（默认20）
- 使用Spring Data的`Page`和`Pageable`接口

### 前端实现

#### 高亮显示
使用`SearchHighlightUtil`工具类：
```java
public String highlight(String text, String keyword) {
    // 不区分大小写的正则匹配
    Pattern pattern = Pattern.compile(
        Pattern.quote(keyword),
        Pattern.CASE_INSENSITIVE
    );
    // 替换为高亮HTML
    return matcher.replaceAll(
        "<span class=\"highlight\">$0</span>"
    );
}
```

#### Thymeleaf模板
```html
<!-- 使用th:utext渲染包含HTML的文本 -->
<span th:utext="${@searchHighlight.highlight(pub.title, keyword)}">
    论文标题
</span>
```

---

## 🌐 URL参数说明

搜索页面支持以下URL参数：

| 参数 | 说明 | 示例 | 必填 |
|------|------|------|------|
| keyword | 搜索关键词 | `?keyword=machine learning` | 否 |
| year | 年份筛选 | `?year=2024` | 否 |
| type | 类型筛选 | `?type=JOURNAL` | 否 |
| page | 页码（从0开始） | `?page=2` | 否 |
| size | 每页数量 | `?size=50` | 否 |

**完整示例**：
```
http://localhost:8080/publications/search?keyword=AI&year=2024&type=JOURNAL&page=0&size=20
```

---

## 💡 常见场景示例

### 场景1：查找某位教授的所有论文
1. 在搜索框输入教授姓名，如："Zhang"
2. 查看搜索结果

### 场景2：查找最新的期刊论文
1. 不输入关键词
2. 选择类型："期刊论文"
3. 选择年份："2024"
4. 点击搜索

### 场景3：查找特定领域的论文
1. 输入领域关键词，如："deep learning"
2. 可选：选择年份范围
3. 查看搜索结果

### 场景4：查找某个会议的论文
1. 输入会议名称，如："CVPR"
2. 选择类型："会议论文"
3. 查看搜索结果

---

## ❓ 常见问题

### Q1: 为什么搜索不到刚添加的论文？
**A:** 确保论文已经保存到数据库。
- 在后台管理中检查论文是否存在
- 检查数据库中是否有该论文记录

### Q2: 搜索中文时为什么没有结果？
**A:** 检查以下几点：
- 数据库中论文信息是否包含中文
- 数据库编码是否设置为UTF-8
- 搜索关键词是否正确

### Q3: 高亮显示不正常怎么办？
**A:** 可能的原因：
- 浏览器缓存问题，按Ctrl+F5强制刷新
- 检查CSS样式是否正确加载

### Q4: 分页没有显示怎么办？
**A:**
- 只有当论文数量超过20条时才会显示分页
- 如果论文少于20条，不会显示分页控件

### Q5: 如何修改每页显示的数量？
**A:** 在URL中添加size参数：
```
?size=50  # 每页显示50条
```

### Q6: 能否搜索论文的DOI？
**A:** 目前不支持DOI搜索，但可以扩展：
在`PublicationRepository`的查询中添加DOI字段：
```java
OR LOWER(p.doi) LIKE LOWER(CONCAT('%', :keyword, '%'))
```

### Q7: 搜索结果的排序规则是什么？
**A:** 当前排序规则：
1. 按年份降序（最新的在前）
2. 年份相同时，按ID降序（最新添加的在前）

### Q8: 能否按相关性排序？
**A:** 当前版本使用简单的LIKE查询，不支持相关性排序。
- 如果需要相关性排序，建议使用Elasticsearch

---

## 🚀 未来扩展功能

### 计划中的功能
- [ ] 按引用次数排序
- [ ] 按相关性排序（需要Elasticsearch）
- [ ] 高级搜索（多条件组合）
- [ ] 搜索历史记录
- [ ] 热门搜索词
- [ ] 搜索建议（输入时自动提示）
- [ ] 按作者筛选（下拉选择）
- [ ] 按期刊筛选（下拉选择）
- [ ] 导出搜索结果（PDF、BibTeX）
- [ ] 搜索结果分享（生成链接）

### 性能优化
- [ ] 添加数据库索引（title、authors、year）
- [ ] 缓存热门搜索结果
- [ ] 异步加载搜索结果
- [ ] 搜索结果预加载（无限滚动）

---

## 📞 技术支持

如果遇到问题，请检查：
1. 数据库中是否有论文数据
2. 浏览器控制台是否有错误信息（F12）
3. 后端日志是否有异常
4. 网络请求是否正常（Network标签）

---

## 🎉 功能完善计划进度

根据功能完善计划，我们已经完成：

### ✅ 2.3 课程大纲功能（已完成）
- ✅ 课程大纲富文本编辑
- ✅ 课程资料文件上传
- ✅ 前台课程详情页展示
- ✅ 资料下载功能

### ✅ 2.5 论文搜索功能（已完成）⭐
- ✅ 前台论文搜索框
- ✅ 按标题、作者、关键词搜索
- ✅ 按年份筛选
- ✅ 按类型筛选
- ✅ 搜索结果高亮显示
- ✅ 分页浏览

---

**祝使用愉快！** 🎉
