# 📚 课程大纲功能使用指南

## 🎯 功能概述

课程大纲功能已完全实现！你现在可以：
- ✅ 使用富文本编辑器编辑课程大纲
- ✅ 上传课程资料（PDF、PPT、Word）
- ✅ 管理课程资料（查看、删除）
- ✅ 在前台展示课程大纲和资料下载链接
- ✅ 支持多种文件格式

---

## 📋 前置准备：运行数据库迁移

在使用功能前，必须先运行数据库迁移脚本：

```bash
# 使用psql命令行
psql -U postgres -d homepage_db -f "SQL files/add-course-syllabus-materials.sql"

# 或在DBeaver等工具中打开并执行该SQL文件
```

这个脚本会为 `teaching_course` 表添加以下字段：
- `syllabus`（TEXT）- 存储课程大纲（富文本HTML）
- `materials`（TEXT）- 存储课程资料列表（JSON格式）

---

## 🚀 使用步骤（手把手教程）

### 第1步：启动应用
```bash
mvn spring-boot:run
```

### 第2步：访问教学课程管理
```
http://localhost:8080/admin/teaching-courses
```

### 第3步：编辑课程

#### 如果是新建课程：
1. 点击"添加教学课程"按钮
2. 填写基本信息（课程名称、课程代码、学期、年份、学分）
3. 填写课程描述（可选）
4. **先点击"保存"按钮**，保存后会生成课程ID
5. 再次点击"编辑"按钮，进入编辑页面
6. 现在可以编辑课程大纲和上传资料了

#### 如果是编辑已有课程：
1. 直接点击课程旁边的"编辑"按钮

### 第4步：编辑课程大纲（富文本）

在编辑页面，找到"课程大纲（富文本）"部分：

1. **点击编辑区域**，会出现富文本编辑工具栏
2. **使用工具栏功能**：
   - 📝 **样式**：标题、段落、引用等
   - **B** 加粗、*I* 斜体、<u>U</u> 下划线
   - 🎨 **文字颜色和背景色**
   - 📋 **列表**：无序列表、有序列表
   - 📊 **表格**：插入表格
   - 🔗 **链接**：插入超链接
   - 🖵 **全屏模式**：全屏编辑
   - 📄 **查看HTML**：查看/编辑HTML代码

3. **编写课程大纲示例**：
   ```
   课程目标
   • 掌握数据结构的基本概念
   • 能够分析算法的时间和空间复杂度
   • 熟练使用常见数据结构解决实际问题

   教学内容
   第一章：数据结构概述
   - 1.1 什么是数据结构
   - 1.2 算法分析基础
   - 1.3 抽象数据类型

   第二章：线性结构
   - 2.1 数组
   - 2.2 链表
   - 2.3 栈和队列
   ...
   ```

4. **点击"保存"按钮**保存课程大纲

### 第5步：上传课程资料

在编辑页面，找到"课程资料"部分（只在编辑模式显示）：

1. **点击"选择文件"按钮**
   - 选择要上传的课程资料
   - 支持格式：PDF、PPT、PPTX、DOC、DOCX
   - 最大大小：20MB

2. **点击"上传资料"按钮**
   - 系统会自动上传文件
   - 上传成功后会显示提示："资料上传成功！"
   - 文件会出现在"已上传的资料"列表中

3. **重复上传多个文件**
   - 可以上传多个课程资料
   - 每个文件独立管理

4. **保存表单**
   - 点击页面底部的"保存"按钮
   - 保存所有更改（包括大纲和资料）

### 第6步：管理课程资料

在"已上传的资料"列表中：

#### 查看资料：
- 每个资料显示文件名和大小
- 点击文件名可以在新标签页中打开
- 不同文件类型显示不同的图标：
  - 📕 PDF文件
  - 📘 PPT文件
  - 📗 Word文件

#### 删除资料：
1. 点击资料右侧的"删除"按钮（垃圾桶图标）
2. 确认删除
3. 系统会删除服务器上的文件
4. 记得点击"保存"按钮保存更改

### 第7步：查看前台效果

1. 访问教授主页：
   ```
   http://localhost:8080/professor/{教授ID}
   ```

2. 在"教学课程"部分，点击课程名称

3. 进入课程详情页，可以看到：
   - **课程描述**（如果有）
   - **课程大纲**（富文本渲染）
   - **课程资料下载**（可下载的文件列表）

4. 点击"下载"按钮，下载课程资料

---

## 🖼️ 界面说明

### 后台管理界面

#### 课程大纲编辑器
```
┌──────────────────────────────────────────────┐
│ 课程大纲（富文本）                            │
├──────────────────────────────────────────────┤
│ [工具栏：样式 B I U 颜色 列表 表格 链接 全屏] │
│                                              │
│ 课程目标                                     │
│ • 掌握数据结构的基本概念                     │
│ • 能够分析算法复杂度                         │
│                                              │
│ 教学内容                                     │
│ 第一章：数据结构概述...                      │
│                                              │
└──────────────────────────────────────────────┘
```

#### 课程资料上传
```
┌──────────────────────────────────────────────┐
│ 课程资料                                     │
├──────────────────────────────────────────────┤
│ [选择文件]           [📤 上传资料]            │
│ 支持 PDF、PPT、Word 格式，最大 20MB         │
│                                              │
│ 已上传的资料                                 │
│ ┌────────────────────────────────────────┐ │
│ │ 📕 lecture1.pdf (2.5 MB)    [🗑️ 删除] │ │
│ │ 📘 slides.pptx (5.3 MB)     [🗑️ 删除] │ │
│ │ 📗 syllabus.docx (0.8 MB)   [🗑️ 删除] │ │
│ └────────────────────────────────────────┘ │
└──────────────────────────────────────────────┘
```

### 前台展示界面

```
┌──────────────────────────────────────────────┐
│ 数据结构与算法                                │
│ [CS101]                                      │
├──────────────────────────────────────────────┤
│ 📅 开课时间                                  │
│ 2024年 春季学期                              │
│                                              │
│ 🏆 学分                                      │
│ 3.0 学分                                     │
│                                              │
│ 📄 课程描述                                  │
│ 本课程介绍数据结构的基本概念...              │
│                                              │
│ 📋 课程大纲                                  │
│ 课程目标                                     │
│ • 掌握数据结构的基本概念                     │
│ • 能够分析算法复杂度                         │
│ ...                                          │
│                                              │
│ 📚 课程资料下载                              │
│ ┌────────────────────────────────────────┐ │
│ │ 📕 lecture1.pdf (2.5MB)    [⬇️ 下载]  │ │
│ │ 📘 slides.pptx (5.3MB)     [⬇️ 下载]  │ │
│ │ 📗 syllabus.docx (0.8MB)   [⬇️ 下载]  │ │
│ └────────────────────────────────────────┘ │
│                                              │
│ [⬅️ 返回教授主页]                            │
└──────────────────────────────────────────────┘
```

---

## 🔧 技术细节

### 富文本编辑器
- **编辑器**：Summernote（轻量级、Bootstrap风格）
- **语言**：中文界面
- **高度**：300px（可调节）
- **功能**：样式、格式、列表、表格、链接、全屏、HTML查看

### 文件存储
- **存储目录**：`项目根目录/uploads/materials/`
- **文件命名**：`course_{courseId}_{uuid}.{扩展名}`
  - 例如：`course_1_a1b2c3d4e5f6.pdf`
- **访问URL**：`/uploads/materials/course_1_a1b2c3d4e5f6.pdf`

### 数据库字段

#### syllabus（课程大纲）
- **类型**：TEXT
- **内容**：富文本HTML
- **示例**：
  ```html
  <p><strong>课程目标</strong></p>
  <ul>
    <li>掌握数据结构的基本概念</li>
    <li>能够分析算法复杂度</li>
  </ul>
  ```

#### materials（课程资料）
- **类型**：TEXT
- **内容**：JSON数组
- **示例**：
  ```json
  [
    {
      "name": "lecture1.pdf",
      "url": "/uploads/materials/course_1_xxx.pdf",
      "size": 2621440
    },
    {
      "name": "slides.pptx",
      "url": "/uploads/materials/course_1_yyy.pptx",
      "size": 5555200
    }
  ]
  ```

### 文件类型支持

| 格式 | 扩展名 | MIME类型 | 图标 |
|------|--------|----------|------|
| PDF | .pdf | application/pdf | 📕 |
| PowerPoint | .ppt, .pptx | application/vnd.ms-powerpoint<br>application/vnd.openxmlformats-officedocument.presentationml.presentation | 📘 |
| Word | .doc, .docx | application/msword<br>application/vnd.openxmlformats-officedocument.wordprocessingml.document | 📗 |

---

## ❓ 常见问题

### Q1: 为什么新建课程时看不到"课程资料"部分？
**A:** 必须先保存课程生成ID后，才能上传资料。
- **解决方法**：先填写基本信息并保存，然后再编辑上传资料。

### Q2: 上传文件时提示"只允许上传PDF、PPT、Word格式"怎么办？
**A:** 检查文件格式是否正确。
- 支持的格式：.pdf, .ppt, .pptx, .doc, .docx
- 不支持的格式：.txt, .jpg, .zip等

### Q3: 上传大文件失败怎么办？
**A:** 检查文件大小是否超过限制。
- 最大限制：20MB
- 如果文件过大，建议：
  1. 压缩PDF文件（减少图片分辨率）
  2. 压缩PPT文件（压缩图片）
  3. 将大文件拆分成多个小文件

### Q4: 富文本编辑器中的格式在前台显示不正常？
**A:** 这可能是CSS样式冲突。
- 检查前台页面的CSS是否覆盖了富文本样式
- 使用"查看HTML"功能检查HTML是否正确

### Q5: 删除资料后还能恢复吗？
**A:** 不能恢复。删除操作会：
1. 删除服务器上的物理文件
2. 从数据库中移除记录
- **建议**：删除前做好备份

### Q6: 课程资料可以批量上传吗？
**A:** 目前不支持批量上传，需要逐个上传。
- **计划**：未来可以添加批量上传功能

### Q7: 可以限制只有学生才能下载资料吗？
**A:** 目前所有访客都可以下载。
- **计划**：未来可以添加权限控制功能

### Q8: 课程大纲支持哪些HTML标签？
**A:** Summernote生成的HTML是安全的，支持：
- 标题：h1-h6
- 段落：p
- 列表：ul, ol, li
- 表格：table, tr, td, th
- 格式：b, i, u, strong, em
- 链接：a
- 其他：div, span等

### Q9: 如何在课程大纲中插入图片？
**A:** 当前版本的富文本编辑器不支持图片插入。
- **原因**：图片会增加页面加载时间
- **建议**：将图片作为课程资料上传
- **计划**：未来可以添加图片上传功能

### Q10: 生产环境部署需要注意什么？
**A:**
1. **文件存储**：
   - 确保 `uploads/materials/` 目录有写权限
   - 定期备份上传的文件
   - 考虑使用云存储（如阿里云OSS）

2. **文件大小限制**：
   - 检查Nginx配置的 `client_max_body_size`
   - 默认为1MB，需要调整到至少20MB

3. **性能优化**：
   - 大文件建议使用CDN加速
   - 启用浏览器缓存

4. **安全性**：
   - 验证文件类型（防止恶意文件）
   - 扫描病毒（可选）
   - 限制下载速率（防止滥用）

---

## 🎉 功能对比

### 之前（没有课程大纲功能）❌
```
❌ 只能填写纯文本描述
❌ 无法提供课程资料下载
❌ 学生需要单独联系索要资料
❌ 内容展示单调
```

### 现在（有课程大纲功能）✅
```
✅ 富文本编辑，支持格式化
✅ 直接上传课程资料
✅ 学生可以自助下载
✅ 内容展示丰富专业
✅ 支持多种文件格式
```

---

## 📊 数据示例

### 示例1：计算机科学课程

**课程大纲**：
```html
<h3>课程目标</h3>
<ul>
  <li>掌握数据结构的基本概念和常用数据结构</li>
  <li>能够分析算法的时间和空间复杂度</li>
  <li>熟练使用C++或Java实现常见数据结构</li>
</ul>

<h3>教学内容</h3>
<table>
  <tr><th>章节</th><th>内容</th><th>学时</th></tr>
  <tr><td>第1章</td><td>数据结构概述</td><td>4</td></tr>
  <tr><td>第2章</td><td>线性结构</td><td>8</td></tr>
  <tr><td>第3章</td><td>树形结构</td><td>10</td></tr>
</table>
```

**课程资料**：
- lecture1.pdf (2.5 MB) - 第一章讲义
- code-examples.zip (1.2 MB) - 代码示例
- assignment1.docx (0.5 MB) - 第一次作业

### 示例2：人文社科课程

**课程大纲**：
```html
<h3>课程简介</h3>
<p>本课程旨在培养学生的批判性思维能力...</p>

<h3>阅读材料</h3>
<ol>
  <li>必读：《XXX》第1-5章</li>
  <li>选读：《YYY》第3章</li>
</ol>

<h3>考核方式</h3>
<ul>
  <li>平时成绩：30%（出勤、讨论）</li>
  <li>期中论文：30%</li>
  <li>期末考试：40%</li>
</ul>
```

**课程资料**：
- syllabus.pdf (0.8 MB) - 课程大纲
- reading-list.pdf (1.5 MB) - 阅读书目
- essay-guidelines.docx (0.3 MB) - 论文写作指南

---

## 🚀 进阶功能（未来可扩展）

- [ ] 批量上传课程资料
- [ ] 课程资料分类（讲义、作业、参考资料）
- [ ] 课程视频嵌入（YouTube、Bilibili）
- [ ] 下载统计（哪些资料最受欢迎）
- [ ] 资料评论和评分
- [ ] 学生提交作业功能
- [ ] 在线预览（PDF、Office文件）
- [ ] 资料版本管理（更新历史）
- [ ] 权限控制（只有注册学生可下载）
- [ ] 资料搜索功能

---

## 📞 技术支持

如果遇到问题，请检查：
1. 浏览器控制台的错误信息（F12）
2. 后端日志输出
3. 数据库是否已执行迁移脚本
4. `uploads/materials/` 目录是否存在且有写权限
5. 文件大小是否超过限制

---

**祝使用愉快！** 🎉
