# 第一阶段第一步：图片上传功能 - 学习指南

## 📚 学习目标

通过实现图片上传功能，您将学习：
1. **文件上传的工作原理**（HTTP multipart/form-data）
2. **Spring Boot文件处理**（MultipartFile）
3. **文件存储策略**（本地文件系统）
4. **数据库设计**（存储文件路径）
5. **前端文件上传**（HTML5 File API）
6. **图片预览和验证**（文件类型、大小限制）

---

## 🎯 功能概述

### 我们要实现什么？
1. **教授头像上传** - 每个教授可以上传一张头像照片
2. **科研项目图片上传** - 每个项目可以上传多张图片

### 为什么需要这个功能？
- **视觉吸引力**：有照片的网站更专业、更有吸引力
- **信息传达**：图片能更直观地展示研究成果
- **用户体验**：访客能更好地认识教授和了解项目

---

## 📖 知识点讲解

### 1. 文件上传的工作原理

#### 什么是文件上传？
当用户在网页上选择一个文件并点击"上传"时，浏览器会将文件内容发送到服务器。

#### HTTP如何传输文件？
- **普通表单**：使用 `application/x-www-form-urlencoded` 编码
  - 只能传输文本数据
  - 格式：`name=value&age=20`

- **文件上传表单**：使用 `multipart/form-data` 编码
  - 可以传输二进制数据（图片、视频、文档）
  - 将表单分成多个部分（parts），每个部分可以是文本或文件

**示例**：
```html
<!-- 普通表单 -->
<form method="post">
    <input type="text" name="name">
    <button type="submit">提交</button>
</form>

<!-- 文件上传表单 -->
<form method="post" enctype="multipart/form-data">
    <input type="file" name="avatar">
    <button type="submit">上传</button>
</form>
```

**关键点**：`enctype="multipart/form-data"` 告诉浏览器使用多部分编码。

---

### 2. Spring Boot如何处理文件上传？

#### MultipartFile接口
Spring Boot提供了 `MultipartFile` 接口来处理上传的文件。

**主要方法**：
```java
// 获取原始文件名
String originalFilename = file.getOriginalFilename();

// 获取文件大小（字节）
long size = file.getSize();

// 获取文件类型（MIME类型）
String contentType = file.getContentType();

// 获取文件内容（字节数组）
byte[] bytes = file.getBytes();

// 保存文件到指定位置
file.transferTo(new File("/path/to/save"));

// 检查文件是否为空
boolean isEmpty = file.isEmpty();
```

#### 为什么使用MultipartFile？
- **简化开发**：不需要手动解析HTTP请求
- **类型安全**：提供了清晰的API
- **自动处理**：Spring自动将上传的文件转换为MultipartFile对象

---

### 3. 文件存储策略

#### 方案A：本地文件系统（我们选择的方案）

**优点**：
- 简单易实现
- 无额外成本
- 完全控制

**缺点**：
- 需要手动备份
- 扩展性有限（单服务器）
- 需要配置静态资源访问

**存储结构**：
```
项目根目录/
├── uploads/              # 上传文件根目录
│   ├── avatars/         # 教授头像
│   │   ├── 1.jpg       # 教授ID_时间戳.扩展名
│   │   ├── 2.png
│   ├── projects/        # 项目图片
│   │   ├── 1_1.jpg     # 项目ID_序号.扩展名
│   │   ├── 1_2.jpg
```

#### 方案B：云存储（未来可升级）
- 阿里云OSS、腾讯云COS
- 更稳定、更安全
- 有CDN加速
- 需要付费

---

### 4. 数据库设计

#### 为什么要在数据库中存储文件路径？
- **文件本身**存储在文件系统中（图片、PDF等）
- **文件路径**存储在数据库中（如：`/uploads/avatars/1.jpg`）
- **原因**：数据库不适合存储大文件，但适合存储元数据

#### 数据库变更
```sql
-- 教授表添加头像字段
ALTER TABLE professor ADD COLUMN avatar_url VARCHAR(500);

-- 科研项目表添加图片字段（JSON数组存储多张图片）
ALTER TABLE research_project ADD COLUMN images TEXT;
```

**为什么项目图片用TEXT类型存储JSON？**
- 一个项目可能有多张图片
- 使用JSON数组：`["img1.jpg", "img2.jpg", "img3.jpg"]`
- 灵活、易于扩展

---

### 5. 安全性考虑

#### 文件上传的安全风险
1. **恶意文件上传**：上传病毒、木马
2. **文件名注入**：使用特殊字符破坏文件系统
3. **大文件攻击**：上传超大文件耗尽磁盘空间
4. **文件类型伪装**：修改扩展名绕过检查

#### 我们的防护措施
1. **文件类型验证**：只允许图片（JPG、PNG、GIF、WebP）
2. **文件大小限制**：单张图片最大5MB
3. **文件名重命名**：使用UUID或时间戳，避免文件名冲突
4. **MIME类型检查**：验证真实文件类型，不只看扩展名
5. **存储路径隔离**：上传文件存储在专门目录，不能执行

---

## 🛠️ 实施步骤

### 步骤1：配置文件上传参数
### 步骤2：数据库变更
### 步骤3：创建文件上传工具类
### 步骤4：修改Professor实体类
### 步骤5：创建文件上传Controller
### 步骤6：修改教授管理表单（添加头像上传）
### 步骤7：配置静态资源访问
### 步骤8：前台显示头像
### 步骤9：测试功能

---

## 📝 学习检查点

在开始实施前，请确认您理解了以下概念：

- [ ] 什么是multipart/form-data？
- [ ] MultipartFile接口的作用是什么？
- [ ] 为什么文件存储在文件系统，路径存储在数据库？
- [ ] 文件上传有哪些安全风险？
- [ ] 如何防止恶意文件上传？

如果有任何不清楚的地方，请随时提问！

---

## 🎓 扩展阅读（可选）

- Spring Boot官方文档：File Upload
- HTTP协议：multipart/form-data详解
- 文件存储最佳实践
- 图片处理：压缩、裁剪、水印

---

准备好了吗？让我们开始实施第一步！
