# 🗺️ 百度地图地点选择器使用指南

## 🎯 功能概述

百度地图地点选择器已完全实现！你现在可以：
- ✅ 在百度地图上直接搜索地点
- ✅ 点击地图选择任意位置
- ✅ 自动获取经纬度坐标
- ✅ 自动获取详细地址
- ✅ 自动设置地图缩放级别
- ✅ 无需手动输入任何坐标信息

---

## 📋 前置准备：申请百度地图API密钥

### 第1步：注册百度账号
1. 访问：https://passport.baidu.com/
2. 如果没有账号，点击"立即注册"
3. 使用手机号或邮箱注册

### 第2步：进入百度地图开放平台
1. 访问：https://lbsyun.baidu.com/
2. 点击右上角"控制台"或直接访问：https://lbsyun.baidu.com/apiconsole/key

### 第3步：创建应用
1. 点击"创建应用"按钮
2. 填写应用信息：
   - **应用名称**：随便填写，例如："教授主页系统"
   - **应用类型**：选择"浏览器端"
   - **Referer白名单**：填写 `*`（开发测试用）或你的域名（生产环境）
     - 开发环境：`*`（允许所有来源）
     - 生产环境：`your-domain.com`（只允许你的域名）

3. 点击"提交"

### 第4步：获取AK（API密钥）
1. 提交后会跳转到应用列表
2. 找到刚创建的应用
3. 复制"访问应用(AK)"列的密钥（一串字母和数字）
   - 示例：`abcdefghijklmnopqrstuvwxyz123456`

### 第5步：配置到项目中
1. 打开文件：`src/main/resources/templates/admin/contact-info-form.html`
2. 找到第243行左右（百度地图API引入代码）：
   ```html
   <script type="text/javascript" src="https://api.map.baidu.com/api?v=3.0&ak=YOUR_BAIDU_MAP_AK"></script>
   ```
3. 将 `YOUR_BAIDU_MAP_AK` 替换为你刚复制的AK：
   ```html
   <script type="text/javascript" src="https://api.map.baidu.com/api?v=3.0&ak=你的AK"></script>
   ```

**重要提示：**
- 免费版每天有配额限制（30万次/天，足够个人网站使用）
- 不要把AK提交到公开的Git仓库（避免被盗用）

---

## 🚀 使用步骤（手把手教程）

### 第1步：运行数据库迁移
在数据库中执行SQL脚本，添加 `map_address` 字段：

```bash
# 使用psql命令行
psql -U postgres -d homepage_db -f "SQL files/add-map-address-field.sql"

# 或者在DBeaver等工具中打开并执行该SQL文件
```

### 第2步：启动应用
```bash
mvn spring-boot:run
```

### 第3步：访问联系信息编辑页面
1. 打开浏览器，访问：`http://localhost:8080/admin/contact-info`
2. 选择一个教授，点击"编辑"或"添加联系方式"

### 第4步：打开地图选择器
找到"地图定位（可选）"部分，点击绿色的"打开地图选择器"按钮

### 第5步：搜索地点（方式1）
1. 在搜索框输入地点名称，例如：
   - "贵州大学"
   - "贵阳市政府"
   - "花溪公园"
2. 点击"搜索"按钮
3. 地图会自动定位到该地点并显示标记
4. 下方会显示详细地址

### 第6步：点击地图选择（方式2）
1. 也可以直接在地图上拖动、缩放
2. 点击任意位置
3. 系统会在该位置添加标记
4. 自动获取并显示该位置的详细地址

### 第7步：确认选择
1. 确认地点无误后，点击"确认选择"按钮
2. 系统会自动填充以下字段：
   - **地图地址**：详细地址（如："贵州省贵阳市花溪区贵州大学"）
   - **纬度**：自动填充（精确到小数点后8位）
   - **经度**：自动填充（精确到小数点后8位）
   - **地图缩放级别**：自动设置为当前地图的缩放级别

### 第8步：保存表单
点击页面底部的"保存"按钮，保存整个联系信息表单

---

## 🖼️ 界面说明

### 地图选择器界面

```
┌─────────────────────────────────────────────────────┐
│  选择地点                                      [X]   │
├─────────────────────────────────────────────────────┤
│  [搜索框：输入地点名称]           [🔍 搜索]         │
│                                                     │
│  ✅ 已选择：贵州省贵阳市花溪区贵州大学              │
│                                                     │
│  ┌─────────────────────────────────────────────┐   │
│  │                                             │   │
│  │            [百度地图显示区域]               │   │
│  │                                             │   │
│  │                 📍                          │   │
│  │                                             │   │
│  └─────────────────────────────────────────────┘   │
│                                                     │
│  ℹ️ 使用说明：                                       │
│  • 在搜索框输入地点名称，点击"搜索"按钮             │
│  • 或者直接在地图上拖动、点击选择位置              │
│  • 选择完成后点击"确认选择"按钮保存                │
│                                                     │
│  [取消]                        [✅ 确认选择]         │
└─────────────────────────────────────────────────────┘
```

### 表单字段（自动填充）

选择地点后，以下字段会自动填充：

```
┌──────────────────────────────────────────────┐
│ 地图地址（自动获取）                          │
│ [贵州省贵阳市花溪区贵州大学]   [只读]        │
│ 从地图API获取的详细地址                      │
└──────────────────────────────────────────────┘

┌────────────┐  ┌────────────┐  ┌──────────────┐
│ 纬度(自动)  │  │ 经度(自动)  │  │ 缩放级别     │
│ 26.43219   │  │ 106.66025  │  │ 15          │
│ [只读]     │  │ [只读]     │  │ [只读]      │
└────────────┘  └────────────┘  └──────────────┘
```

---

## 🎨 地图控件说明

### 地图上的控件
- **🧭 导航控件**（左上角）：平移和缩放地图
- **📏 比例尺控件**（左下角）：显示地图比例尺
- **🗺️ 缩略图控件**（右下角）：显示当前区域的缩略图
- **🖱️ 滚轮缩放**：使用鼠标滚轮缩放地图

### 标记点
- 选择位置后会显示一个红色的标记点 📍
- 标记点会有一个短暂的跳动动画
- 点击其他位置会移动标记点

---

## 🔧 技术细节

### 前端实现
- **地图API**：百度地图JavaScript API v3.0
- **地理编码**：`BMap.Geocoder` - 将坐标转换为地址
- **地点搜索**：`BMap.LocalSearch` - 搜索地点名称
- **模态框**：Bootstrap 5 Modal

### 数据库字段
| 字段名 | 类型 | 说明 |
|--------|------|------|
| `map_address` | VARCHAR(500) | 从地图API获取的详细地址 |
| `latitude` | DOUBLE | 纬度（精确到小数点后8位） |
| `longitude` | DOUBLE | 经度（精确到小数点后8位） |
| `map_zoom` | INTEGER | 地图缩放级别（1-20） |

### 坐标系说明
百度地图使用的是 **BD-09 坐标系**（百度自己的坐标系）

如果需要在其他地图上使用（如高德地图、Google地图），需要进行坐标转换：
- BD-09 → GCJ-02（火星坐标，高德地图）
- BD-09 → WGS-84（GPS坐标，国际标准）

---

## ❓ 常见问题

### Q1: 地图显示空白，控制台报错"ak参数不能为空"
**A:** 你还没有配置百度地图API密钥。
- **解决方法：** 按照上面的"前置准备"步骤申请AK并配置到代码中

### Q2: 地图显示"此地图API仅供企业开发者认证使用"
**A:** 选错了API类型。
- **解决方法：** 在百度地图开放平台重新创建应用，应用类型选择"浏览器端"

### Q3: 搜索地点时提示"未找到该地点"
**A:** 搜索关键词不够准确。
- **解决方法：**
  - 使用更具体的关键词，例如："贵州大学花溪校区"
  - 或者直接在地图上拖动到目标位置，点击选择

### Q4: 选择的位置不够精确怎么办？
**A:** 可以放大地图后再选择。
- **解决方法：**
  - 滚动鼠标滚轮放大地图
  - 或使用左上角的"+"按钮放大
  - 放大后点击更精确的位置

### Q5: 如何修改已选择的位置？
**A:** 直接重新打开地图选择器。
- **解决方法：**
  - 点击"打开地图选择器"按钮
  - 地图会显示当前保存的位置
  - 搜索或点击新位置
  - 点击"确认选择"更新

### Q6: 生产环境部署需要注意什么？
**A:**
1. **修改Referer白名单**
   - 在百度地图控制台，编辑应用
   - 将Referer白名单从 `*` 改为你的域名
   - 例如：`yourdomain.com` 或 `*.yourdomain.com`

2. **HTTPS支持**
   - 百度地图API支持HTTPS
   - 如果你的网站使用HTTPS，地图也会自动使用HTTPS

3. **配额监控**
   - 登录百度地图控制台查看API调用次数
   - 免费版每天30万次，超出会限流
   - 如果流量大，可以升级为付费版

### Q7: 能用高德地图或Google地图吗？
**A:** 可以，但需要修改代码。
- **高德地图：** 类似实现，需要申请高德地图API密钥
- **Google地图：** 需要翻墙，且国内用户体验不佳
- **推荐使用百度地图：** 国内覆盖最全，API文档完善

### Q8: 初始化时默认显示哪里？
**A:** 有两种情况：
1. **编辑已有位置：** 显示当前保存的位置
2. **新建联系信息：** 显示贵阳市中心（可在代码中修改默认位置）

修改默认位置：在 `contact-info-form.html` 中找到：
```javascript
const initLat = currentLat || 26.647661;  // 修改默认纬度
const initLng = currentLng || 106.630153;  // 修改默认经度
```

---

## 🎉 进阶功能（未来可扩展）

- [ ] 支持多个地点标记
- [ ] 路线规划（如何到达办公室）
- [ ] 周边设施显示（附近的餐厅、停车场等）
- [ ] 街景查看
- [ ] 3D地图模式
- [ ] 自定义标记图标
- [ ] 地图截图保存

---

## 📚 参考文档

- 百度地图开放平台：https://lbsyun.baidu.com/
- JavaScript API文档：https://lbsyun.baidu.com/cms/jsapi/reference/jsapi_reference_3_0.html
- 示例中心：https://lbsyun.baidu.com/jsdemo.htm

---

## 📞 技术支持

如果遇到问题，请检查：
1. 浏览器控制台的错误信息（F12）
2. 百度地图API密钥是否正确配置
3. 网络是否正常（百度地图需要联网）
4. 数据库是否已执行迁移脚本

---

**祝使用愉快！** 🎉
