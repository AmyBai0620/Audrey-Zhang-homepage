# 📱 微信二维码上传功能使用指南

## 🎯 功能概述

微信二维码上传功能已完全实现！你现在可以：
- ✅ 直接在管理界面上传微信二维码图片
- ✅ 实时预览上传的二维码
- ✅ 删除和重新上传二维码
- ✅ 自动保存到数据库，前台可以展示

---

## 📝 操作步骤（手把手教程）

### 第1步：启动应用
```bash
# 在项目根目录运行
mvn spring-boot:run

# 或者在IDEA中点击运行按钮
```

### 第2步：访问管理后台
1. 打开浏览器，访问：`http://localhost:8080/admin`
2. 找到"联系方式管理"（Contact Info Management）

### 第3步：创建或编辑联系信息

**重要提示：** 必须先保存联系信息记录，才能上传二维码！

#### 如果是新建联系信息：
1. 点击"添加联系方式"按钮
2. 选择对应的教授
3. 填写基本信息（办公室地点、电话等）
4. **先点击"保存"按钮**，保存后页面会跳转到列表
5. 再次点击"编辑"按钮，进入编辑页面

#### 如果是编辑已有联系信息：
1. 直接点击"编辑"按钮进入编辑页面

### 第4步：上传微信二维码

在编辑页面，找到"微信二维码"部分：

1. **点击"选择文件"按钮**
   - 选择你的微信二维码图片
   - 支持格式：JPG、PNG、GIF、WebP
   - 最大大小：5MB

2. **点击"上传"按钮**
   - 系统会自动上传图片
   - 上传成功后会显示提示："二维码上传成功！"

3. **查看预览**
   - 上传成功后，会在下方自动显示二维码预览
   - 预览图片最大尺寸为 200x200 像素

4. **保存表单**
   - 二维码URL已自动保存到隐藏字段
   - 点击页面底部的"保存"按钮，保存整个表单

### 第5步：删除二维码（可选）

如果需要删除已上传的二维码：

1. 在预览区域下方，点击"删除二维码"按钮
2. 确认删除
3. 系统会删除服务器上的文件，并清空数据库中的URL
4. 点击"保存"保存修改

---

## 🖼️ 界面说明

### 新建模式（contactInfo.id 为空）
```
┌─────────────────────────────────────┐
│ ⚠️ 请先保存联系信息，然后再上传微信二维码 │
└─────────────────────────────────────┘
```
**提示：** 必须先保存联系信息，才会有ID，才能上传二维码

### 编辑模式（contactInfo.id 已存在）

#### 未上传二维码时：
```
┌─────────────────────────────────────┐
│ 微信二维码                            │
│                                     │
│ [选择文件] [📤 上传]                  │
│                                     │
│ 支持 JPG、PNG、GIF、WebP，最大 5MB   │
└─────────────────────────────────────┘
```

#### 已上传二维码时：
```
┌─────────────────────────────────────┐
│ 微信二维码                            │
│                                     │
│ [选择文件] [📤 上传]                  │
│                                     │
│ ┌─────────────────────┐             │
│ │   [二维码预览图片]    │             │
│ │                     │             │
│ │  [🗑️ 删除二维码]     │             │
│ └─────────────────────┘             │
└─────────────────────────────────────┘
```

---

## 🔧 技术细节

### 后端接口

#### 1. 上传二维码接口
- **URL:** `POST /api/upload/qrcode/{contactInfoId}`
- **参数:** `file` (MultipartFile)
- **功能:**
  - 验证文件类型和大小
  - 保存到 `uploads/qrcodes/` 目录
  - 更新数据库中的 `wechat_qrcode` 字段
  - 返回二维码URL

#### 2. 删除二维码接口
- **URL:** `DELETE /api/upload/qrcode/{contactInfoId}`
- **功能:**
  - 删除服务器上的文件
  - 清空数据库中的 `wechat_qrcode` 字段

### 文件存储

- **存储目录:** `项目根目录/uploads/qrcodes/`
- **文件命名:** `qrcode_{contactInfoId}_{uuid}.{扩展名}`
  - 例如：`qrcode_1_a1b2c3d4e5f6.jpg`
- **访问URL:** `/uploads/qrcodes/qrcode_1_a1b2c3d4e5f6.jpg`

### 数据库字段

- **表名:** `contact_info`
- **字段名:** `wechat_qrcode`
- **类型:** `VARCHAR(500)`
- **示例值:** `/uploads/qrcodes/qrcode_1_a1b2c3d4e5f6.jpg`

---

## ❓ 常见问题

### Q1: 为什么新建时看不到上传按钮？
**A:** 必须先保存联系信息，系统才会生成ID，才能上传二维码。
- **解决方法:** 先填写基本信息并保存，然后再编辑上传二维码。

### Q2: 上传后显示"上传失败"怎么办？
**A:** 检查以下几点：
1. 文件格式是否正确（JPG、PNG、GIF、WebP）
2. 文件大小是否超过5MB
3. 浏览器控制台是否有错误信息
4. 后端日志是否有异常

### Q3: 上传的图片在哪里？
**A:** 图片保存在项目根目录的 `uploads/qrcodes/` 文件夹中。

### Q4: 可以直接访问上传的图片吗？
**A:** 可以！通过URL访问：
```
http://localhost:8080/uploads/qrcodes/qrcode_1_xxxxx.jpg
```

### Q5: 如何更换二维码？
**A:** 有两种方式：
1. **直接上传新图片**（推荐）
   - 系统会自动删除旧图片
   - 上传新图片
2. **先删除再上传**
   - 点击"删除二维码"按钮
   - 再上传新图片

### Q6: 删除联系信息后，二维码图片会被删除吗？
**A:** 目前不会自动删除。如果需要清理，可以手动删除 `uploads/qrcodes/` 目录中的文件。

### Q7: 生产环境部署需要注意什么？
**A:**
1. 确保 `uploads/qrcodes/` 目录有写权限
2. 考虑使用CDN或对象存储（如阿里云OSS）来存储图片
3. 配置Nginx反向代理时，注意文件上传大小限制

---

## 🎨 前端展示

上传的微信二维码会保存到 `contact_info.wechat_qrcode` 字段，你可以在前台页面使用：

```html
<!-- Thymeleaf 模板示例 -->
<div th:if="${contactInfo.wechatQrcode}">
    <img th:src="${contactInfo.wechatQrcode}"
         alt="微信二维码"
         class="img-fluid">
</div>
```

---

## 🚀 进阶功能（未来可扩展）

- [ ] 支持裁剪功能（上传前裁剪成正方形）
- [ ] 支持拖拽上传
- [ ] 批量上传多个二维码
- [ ] 二维码扫描验证
- [ ] 图片压缩优化
- [ ] 使用云存储（阿里云OSS、腾讯云COS）

---

## 📞 技术支持

如果遇到问题，请检查：
1. 浏览器控制台的错误信息（F12）
2. 后端日志输出
3. `uploads/qrcodes/` 目录是否存在且有写权限

---

**祝使用愉快！** 🎉
